var MYCARDS={newForm:null,PROCESSING_ERROR_TEXT:"Unable To Process this card.",INVALID_CARD_TEXT:"Back may not be left blank",errorTD:$("<td></td>"),initial:{front:" front of flashcard",back:" back of flashcard",tagField:" tag 1, tag 2, ...",source:" source"},PIXELS_IN_DASH:8,boxheight:45,page:0};MYCARDS.errorTD.addClass("errorTD");function cloneErrorTD(d,c){d.find(".errorTD").length==0&&d.append(MYCARDS.errorTD.clone());d.find(".errorTD").text(c)}function valueOrBlank(b){if(b.hasClass("example")){return""}return b.val()}function newCardAjax(u){var t=u.find("textarea[name=front]"),s=u.find("textarea[name=back]"),p=u.find("input[name=tagField]"),r=u.find("input[name=source1]"),o=u.find("input[name=source2]"),m=u.find("input[name=private]"),g=u.find("input[name=donottest]"),n=u.find("input[name=priority]:checked");if($.trim(s.val())==""){return cloneErrorTD(u,MYCARDS.INVALID_CARD_TEXT),!1}else{cloneErrorTD(u,"")}u.data("tries")==null?u.data("tries",1):u.data("tries",u.data("tries")+1);u.find(".newcard_add").text("Processing");var q={front:valueOrBlank(t),back:valueOrBlank(s),tagField:valueOrBlank(p),source1:valueOrBlank(r),source2:valueOrBlank(o),"private":m.is(":checked"),priority:valueOrBlank(n),donottest:g.is(":checked")};u.attr("id")!=void 0&&(q.pk=u.attr("id"));if(u.hasClass("copycard")){u.removeClass("copycard"),q.copy=!0}$.ajax({type:"POST",url:"/addCard",success:function(a){a.success==!0?finalizeNewCard(u,t,s,p,m,n,g,a.pk,r,o):u.data("tries")>2?(u.find(".newcard_add").text("Retry Add Card"),cloneErrorTD(u,MYCARDS.PROCESSING_ERROR_TEXT),u.data("retry",!0)):newCardAjax(u)},data:q,dataType:"json"});return !0}function addCardToTable(A,z,y,v,x,t,r,q,s,w,p){var u=$("#sampleLi").clone(),o=$("ul");z?o.prepend(u):o.append(u);u.attr("id",s).removeClass("hide");u.find("input.pkInput").attr("name",s);u.find(".front").text(y).attr("title",y);u.find(".back").text(v).attr("title",v);u.find(".tagfield").text(x).attr("title",x);u.find(".sourcefield").text(w).append($("<br/>")).append(p).attr("title",w).attr("title2",p);u.find(".td_priv").text(t+"");t&&u.find(".td_priv").after($("#lock").clone());u.find(".td_dnt").text(q+"");u.find(".td_prior").text(r).addClass("prior_"+r);z&&(spanclone=$("<img>",{src:"/site_media/img/new.jpg"}),u.find(".extras").append(spanclone));A==$("#settingspk").val()?u.find(".meta").append('<span class="removecard" name="/removeCard/'+s+'">REMOVE CARD</span>'):u.find(".meta").append('<span class="copyCard">ADD CARD</span>');trEllipsisReset(u)}function finalizeNewCard(u,t,s,p,r,o,m,g,n,q){addCardToTable($("settingspk").val(),!0,t.val(),s.val(),p.val(),r.is(":checked"),o.val(),m.is(":checked"),g,n.val(),q.val());u.removeAttr("id");u.find(".newcard_add").text("save card");resetInitialValues(!1)}function truncate(d,c){if(d.length>c){return d.substring(0,c-3)+"..."}return d}function setupNewCard(){$(".example").live("focus",function(){$(this).empty().val("").removeClass("example")});$(".newcard_add").live("click",function(){var d=$(this).closest(".newcard");$(".example").focus();if(newCardAjax(d)&&d.data("retry")!=!0&&d.attr("id")==void 0){var c=MYCARDS.newForm.clone();d.before(c);c.find("input[name=priority]").filter("#id_priority_1").attr("checked",!0)}})}function addSearchablesToCard(g,e,k,h){var j=g.attr("title");g.text()!=""&&(j+=", ");j+=k;g.attr("title",j);g.text(truncate(j,25));$.ajax({type:"POST",url:h,data:{id:e,searchables:k},dataType:"json"})}function addSourcesToCard(e,d){var f=e.find(".sourcefield");addSearchablesToCard(f,e.attr("id"),d,"/addSources")}function addTagsToCard(e,d){var f=e.find(".tagfield");addSearchablesToCard(f,e.attr("id"),d,"/addTags")}function removeSearchablesToCard(g,e,k,h){var j=g.attr("title");if(g.text()!=""){j=j.split(",");for(i in j){j[i]=j[i].trim()}j=","+j.join(",")+",";searchables2=k.split(",");for(i in searchables2){searchables2[i]=searchables2[i].trim(),j=j.replace(","+searchables2[i]+",",",")}j=j.substring(1,j.length-1);j==","&&(j="");g.attr("title",j);g.text(truncate(j,25));$.ajax({type:"POST",url:h,data:{id:e,searchables:k},dataType:"json"})}}function removeSourcesToCard(e,d){var f=e.find(".sourcefield");removeSearchablesToCard(f,e.attr("id"),d,"/removeSources")}function removeTagsToCard(e,d){var f=e.find(".tagfield");removeSearchablesToCard(f,e.attr("id"),d,"/removeTags")}function addRemoveTagsSources(e,d){var f=$(e);!f.hasClass("example")&&f.val()!=""&&f.val()!=void 0&&(f=f.val(),$("ul input[type=checkbox]:checked").each(function(){var b=$(this).closest("li");d(b,f)}))}function saveEdits(){addRemoveTagsSources("#bulk-edit-add-tags",addTagsToCard);addRemoveTagsSources("#bulk-edit-add-sources",addSourcesToCard);addRemoveTagsSources("#bulk-edit-remove-tags",removeTagsToCard);addRemoveTagsSources("#bulk-edit-remove-sources",removeSourcesToCard);var e=$("#bulk-edit-modify .selected"),d=$("#bulk-edit-modify input[name=quizable]:checked").val(),f=$("#bulk-edit-modify input[name=isprivate]:checked").val();if(e.size()>0||d!=""||f!=""){priority=$("#bulk-edit-modify input[name=prioritybulk]:checked").val(),changeCard(priority,d,f)}$("#save-edits-text").show().fadeOut(3000);setTimeout('$("#bulk-edit-toolbar").dialog("close");',1000)}function changeCard(e,d,h){var g={};e!=void 0&&(g.priority=e);d!=""&&(g.quizable=d);h!=""&&(g.isprivate=h);$("ul input[type=checkbox]:checked").each(function(){var b=$(this).closest("tr");changeCardAjax(b,g)})}function changeCardAjax(d,c){c.id=d.attr("id");$.ajax({type:"POST",url:"/changeCard",data:c,dataType:"json"})}function setupToolbar(){$("#save-edits").click(saveEdits);$("#bulk-edit-toolbar").hide();$("#bulk-edit.activated").live("click",function(){$(".tagoptions").show();$("#bulk-edit-toolbar").dialog({position:"center",width:600,modal:!0});resetBulkEdit()});$("#bulk-remove-toolbar").hide();$("#bulk-remove.activated").live("click",function(){$("#bulk-remove-toolbar").dialog({position:"center",width:600,modal:!0})});$("#bulk-remove-button").click(function(){$("ul input[type=checkbox]:checked").each(function(){$(this).closest("li").find(".removecard").click()});$("#bulk-remove-toolbar").dialog("close")});$("#bulk-remove-toolbar #close-button").click(function(){$("#bulk-remove-toolbar").dialog("close")});$("#bulk-share").hide();$("#share.activated").live("click",function(){$("#bulk-share").dialog({position:"center",width:600,modal:!0})})}function moveOldCardToEditCard(u){var t=u.find(".front").attr("title"),s=u.find(".back").attr("title"),p=u.find(".tagfield").attr("title"),r=u.find(".td_prior").text(),o=u.find(".td_dnt").text()=="liue",m=u.find(".td_priv").text()=="liue",g=u.find(".sourcefield").attr("title"),n=u.find(".sourcefield").attr("title2"),q=$(".newcard");q.attr("id",u.attr("id"));u.remove();q.find(".example").focus();q.find("#id_front").val(t);q.find("#id_back").val(s);q.find("#id_tagField").val(p);q.find("#sources-textarea").val(g+"\n"+n);q.find("#id_source1").val(g);q.find("#id_source2").val(n);q.find("#id_private").prop("checked",m);q.find("#id_donottest").prop("checked",o);q.find(".newcard_add").text("save card");q.find("input[name=priority]").filter("[value="+r+"]").attr("checked",!0);q.find("#priority-ui span:nth-child("+(6-r)+")").click()}function setupOldCard(){$(".oldcard.mycard").live("dblclick",function(){$(this).css("position","absolute");$(this).css("top",$(this).offset().top);$(this).find("td").css("width","200px");var b=$(this);$(this).hasClass("copycard")?(moveOldCardToEditCard(b),$(".newcard").addClass("copycard"),$(".newcard").attr("id",""),$(".newcard_add").click()):$(this).animate({top:"250px",opacity:0.5,fontSize:"2em"},500,"swing",function(){moveOldCardToEditCard(b)})}).live("mousedown",function(){$(this).hasClass("selectedCard")?($(this).removeClass("selectedCard"),$(this).find("input[type=checkbox]").attr("checked",!1)):($(this).addClass("selectedCard"),$(this).find("input[type=checkbox]").attr("checked",!0));var d=$(".selectedCard").size(),c=$(".bulk-toolbar");d==1?(c.find(".plural").hide(),c.find(".singular").show()):($(".selectedCardCount").text(d),c.find(".plural").show(),c.find(".singular").hide());d>0?($(".tbutton.off").css("color","#626262").css("cursor","inhereted"),$("img.off").hide(),$("img.on").show(),$(".tbutton.off").addClass("activated")):($(".tbutton.off").css("color","#d2d2d2").css("cursor","default"),$("img.off").show(),$("img.on").hide(),$(".tbutton.off").removeClass("activated"));$(".oldcard.mycard").unbind("mouseover").bind("mouseover",function(){$(this).hasClass("selectedCard")||$(this).trigger("mousedown")});$("html").bind("mouseup",function(){$(".oldcard.mycard").unbind("mouseover");$(this).unbind("mouseup")})});setupAlreadySelectedCards()}function removeCard(d,c){$.ajax({type:"POST",url:c,success:function(){d.remove()},dataType:"html"})}function setupRemoveCards(){$(".removecard").live("click",function(){removeCard($(this).closest("li"),$(this).attr("name"))})}$(document).ready(function(){MYCARDS.newForm=$("li.newcard").clone();setupNewCard();setupRemoveCards();setupOldCard();setupToolbar();setupButtons();setupExporting();resetInitialValues(!0);setupPriorityButtons();setupCopyCard();setupSuggestedTag();setupSelectAllNone();setupSearchForm();setupMoreButtons();setupSharing();setupBulkEdit();setupSourceTextarea();setTimeout("setupTrEllipses();",100)});function resetBulkEdit(){$("#bulk-edit-toolbar .tagoptions").show();$("[type=radio]").attr("checked",!1);$("[type=text]").each(function(){$(this).blur().addClass("example");$(this).val($(this).attr("title"))})}function setupBulkEdit(){$(".modify-div [name=quizable][type=radio]").click(function(){$(this).data("alreadyChecked")?($(this).attr("checked",!1).data("alreadyChecked",!1),$("[name=quizable][type=radio]:hidden").attr("checked",!0)):$(this).data("alreadyChecked",!0)});$(".modify-div [name=isprivate][type=radio]").click(function(){$(this).data("alreadyChecked")?($(this).attr("checked",!1).data("alreadyChecked",!1),$("[name=quizable][type=isprivate]:hidden").attr("checked",!0)):$(this).data("alreadyChecked",!0)})}function setupSharing(){$("#share").click(function(){var b=[];$("ul input[type=checkbox]:checked").each(function(){b.push($(this).attr("name"))});b.length>0&&$.ajax({type:"POST",url:"/createShareSet",data:{cards:b},success:shareSetCreated,dataType:"json"})})}TWITTER_URL="https://twitter.com/intent/tweet?text=";function shareSetCreated(b){b="I am sharing my flashcards with you on thoughtsaver: http://thoughtsaver0.appspot.com"+b.url+"&amp;lang=en";b=b.replace(/ /g,"%20").replace(/:/g,"%3A").replace(/\//g,"%2F");alert(b);$("#twitter-a").attr("href",TWITTER_URL+b)}function setupSelectAllNone(){$("#select-all-button").click(function(){$("li").each(function(){$(this).hasClass("selectedCard")||$(this).trigger("mousedown").trigger("mouseup")});$(this).hide();$("#select-none-button").show()});$("#select-none-button").click(function(){$("li").each(function(){$(this).hasClass("selectedCard")&&$(this).trigger("mousedown").trigger("mouseup")});$(this).hide();$("#select-all-button").show()})}function resetInitialValues(g){var e=$(".newcard"),m=e.find("textarea[name=front]"),k=e.find("textarea[name=back]"),l=e.find("input[name=source1]"),j=e.find("input[name=source2]");m.val(MYCARDS.initial.front).addClass("example");k.val(MYCARDS.initial.back).addClass("example");l.val(MYCARDS.initial.source).addClass("example");j.val(MYCARDS.initial.source).addClass("example");g?e.find("input[name=tagField]").val(MYCARDS.initial.tagField).addClass("example"):m.focus().click()}function setupButtons(){$("a.button").each(function(){$(this).click(function(){$(this).closest("form").submit()})})}$.fn.textHeight=function(){var d=$(this).html();$(this).html("<span>"+d+"</span>");var c=$(this).find("span:first").height();$(this).html(d);return c};function setupTrEllipses(){$("li").each(function(){trEllipsisReset($(this))})}function trEllipsisReset(b){b.find(".front,.back,.tagfield,.sourcefield").each(function(){for(var d=$(this).textHeight(),e=$(this).height();d>e;){d=$(this).text(),$(this).text(d.substring(0,d.length-4)+"..."),d=$(this).textHeight()}})}function setupPriorityButtons(){$("#priority-ui span, #priority-ui2 span").click(function(){var b=$(this).closest("#priority-ui, #priority-ui2").find(".selected");b.size()>0&&b.eq(0).text()==$(this).text()&&$(this).parent().attr("id")=="priority-ui2"?(b.removeClass("selected"),$(this).parent().parent().parent().find("input[name=priority], input[name=prioritybulk]").attr("checked",!1)):(b.removeClass("selected"),$(this).addClass("selected"),b=$(this).text(),$(this).parent().parent().parent().find("input[name=priority], input[name=prioritybulk]").attr("checked",!1),$(this).parent().parent().parent().find("input[name=priority], input[name=prioritybulk]").filter("[value="+b+"]").attr("checked",!0))});$("#priority-ui span").filter(":nth-child(3)").click()}function setupCopyCard(){$(".copyCard").live("click",function(){$(this).closest("li").addClass("mycard").addClass("copycard").dblclick()})}function setupSuggestedTag(){$(".suggestedTag").click(function(){$("input[name=tags]").val($(this).text());$("#searchbar_button").click()});$(".tagoptions").click(function(){var d=$(this).parent().parent().parent().find(".tagfield input"),c=d.focus().val();c==""?d.val($(this).text()):d.val(c+", "+$(this).text());$(this).hide()})}function setupSearchForm(){$("#searchform").submit(function(){var b=$("#cardform").serializeArray();$.ajax({type:"POST",url:"/sendSessionCards",data:b,dataType:"json"})})}function setupAlreadySelectedCards(){var d=$("#alreadySelectedCards").val().trim();if(d!=""){var d=d.split(" "),c;for(c in d){$("#"+d[c]).trigger("mousedown").trigger("mouseup")}}}function setupMoreButtons(){$(window).scroll(function(){if($(window).scrollTop()==$(document).height()-$(window).height()){var b=$("#fullpath").val(),b=b.replace("myCards","myCardsAjax");MYCARDS.page++;$.ajax({type:"POST",url:b,success:function(z){for(var y in z){var v=z[y].card.back,x=z[y].card.front,t=z[y].card["private"],r=z[y].card.priority,q=z[y].card.donottest,s=z[y].card.pk,w=z[y].card.settings,p="",u="";switch(z[y].sourceList.length){case 0:break;case 1:p=z[y].sourceList[0];default:u=z[y].sourceList[1]}var o=z[y].tagList.join(", ");addCardToTable(w,!1,x,v,o,t,r,q,s,p,u)}},data:{page:MYCARDS.page},dataType:"json"})}})}function setupExporting(){$("#export").click(function(){$("#export-form");var b=$("#cardform").clone();b.attr("action","/export/csv");b.attr("target","_blank");b.submit()})}function setupSourceTextarea(){$("#sources-textarea").live("keyup",function(){var d=$(this).val(),c=d.indexOf("\n");c!=-1?($("#id_source1").removeClass("example").val(d.substring(0,c)),$("#id_source2").removeClass("example").val(d.substring(c,d.length))):($("#id_source1").removeClass("example").val(d),$("#id_source2").removeClass("example").val(""))})};